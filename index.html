<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>Calculadora M치gica 췅 Profesional</title>

    <!-- Librer칤as JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qz-tray/2.1.0/qz-tray.js"></script>
    
    <!-- Font Awesome para iconos (opcional pero mejora la vista) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="styles.css" />
</head>
<body>

    <!-- ===== MEN칔 LATERAL PROFESIONAL ===== -->
    <nav class="sidebar" id="mainSidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-calculator"></i>
                <span class="logo-text">Calculadora M치gica</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="sidebar-user">
            <i class="fas fa-store"></i>
            <span id="sidebarStoreName">Mi Negocio</span>
        </div>
        <ul class="sidebar-menu">
            <li class="menu-item active" data-section="dashboard" onclick="showSection('dashboard')">
                <i class="fas fa-chart-line"></i> <span>Dashboard</span>
            </li>
            <li class="menu-item" data-section="punto-venta" onclick="showSection('punto-venta')">
                <i class="fas fa-shopping-cart"></i> <span>Punto de Venta</span>
            </li>
            <li class="menu-item" data-section="productos" onclick="showSection('productos')">
                <i class="fas fa-boxes"></i> <span>Gesti칩n Productos</span>
            </li>
            <li class="menu-item" data-section="inventario" onclick="showSection('inventario')">
                <i class="fas fa-clipboard-list"></i> <span>Inventario</span>
            </li>
            <li class="menu-item" data-section="reportes" onclick="showSection('reportes')">
                <i class="fas fa-file-pdf"></i> <span>Reportes</span>
            </li>
            <li class="menu-item" data-section="configuracion" onclick="showSection('configuracion')">
                <i class="fas fa-cog"></i> <span>Configuraci칩n</span>
            </li>
            <li class="menu-item" data-section="respaldo" onclick="showSection('respaldo')">
                <i class="fas fa-database"></i> <span>Respaldo</span>
            </li>
        </ul>
        <div class="sidebar-footer">
            <span>춸 <span id="currentYear"></span> - v2.0</span>
            <div class="copyright-icon" onclick="toggleCopyrightNotice()">춸</div>
        </div>
    </nav>

    <!-- ===== CONTENIDO PRINCIPAL ===== -->
    <main class="main-content" id="mainContent">

        <!-- Mensaje de Copyright -->
        <div class="copyright-notice" id="copyrightNotice">
            <button class="close-btn" onclick="toggleCopyrightNotice()">칑</button>
            <strong>ADVERTENCIA:</strong> Este sistema est치 protegido por derechos de autor.
            <strong>No revendas tu c칩digo de acceso</strong> o ser치 bloqueado y perder치s tu dinero.
        </div>

        <!-- SECCI칍N DASHBOARD (por defecto) -->
        <section id="dashboard-section" class="content-section active">
            <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                    <div class="stat-details">
                        <span class="stat-label">Ganancia Total Estimada</span>
                        <span class="stat-value" id="gananciaTotalUSD">$0.00</span>
                        <span class="stat-value-small" id="gananciaTotalBS">Bs 0.00</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-box"></i></div>
                    <div class="stat-details">
                        <span class="stat-label">Total Productos</span>
                        <span class="stat-value" id="totalProductosCount">0</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="stat-details">
                        <span class="stat-label">Stock Bajo</span>
                        <span class="stat-value" id="stockBajoCount">0</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-chart-pie"></i></div>
                    <div class="stat-details">
                        <span class="stat-label">Total Invertido</span>
                        <span class="stat-value" id="totalInvertidoUSD">$0.00</span>
                        <span class="stat-value-small" id="totalInvertidoBS">Bs 0.00</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Accesos R치pidos</h2>
                <div class="quick-actions">
                    <button onclick="showSection('punto-venta')" class="quick-btn"><i class="fas fa-cash-register"></i> Ir a Vender</button>
                    <button onclick="showSection('productos')" class="quick-btn"><i class="fas fa-plus-circle"></i> Nuevo Producto</button>
                    <button onclick="generarReporteDiario()" class="quick-btn"><i class="fas fa-file-pdf"></i> Reporte Diario</button>
                </div>
            </div>
        </section>

        <!-- SECCI칍N PUNTO DE VENTA -->
        <section id="punto-venta-section" class="content-section">
            <h1><i class="fas fa-shopping-cart"></i> Punto de Venta</h1>

            <div class="card scanner-card">
                <div class="scanner-input">
                    <input type="text" id="codigoBarrasInput" placeholder="游댌 Escanea o busca producto..." autocomplete="off" />
                    <button onclick="agregarPorCodigoBarras()">Agregar</button>
                </div>
                <div id="sugerencias" class="sugerencias-lista"></div>
                <div class="scanner-status" id="scannerStatus">
                    <i class="fas fa-barcode"></i> Esperando escaneo...
                </div>
            </div>

            <div class="carrito-ventas card">
                <h2>Carrito de Ventas</h2>
                <div class="carrito-totales">
                    <div class="carrito-total" id="totalCarritoBs">
                        <strong>Total Bs:</strong> 0,00
                    </div>
                    <div class="carrito-total" id="totalCarritoDolares">
                        <strong>Total USD:</strong> 0,00
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="carrito-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>P/U (Bs)</th>
                                <th>Cantidad</th>
                                <th>Unidad</th>
                                <th>Subtotal (Bs)</th>
                                <th>Acc.</th>
                            </tr>
                        </thead>
                        <tbody id="carritoBody"></tbody>
                    </table>
                </div>

                <div class="finalizar-venta">
                    <button id="finalizarVenta" onclick="finalizarVenta()"><i class="fas fa-check-circle"></i> Finalizar Venta</button>
                </div>
            </div>
        </section>

        <!-- SECCI칍N PRODUCTOS (Gesti칩n) -->
        <section id="productos-section" class="content-section">
            <h1><i class="fas fa-boxes"></i> Gesti칩n de Productos</h1>

            <div class="card">
                <h2>Agregar / Editar Producto</h2>
                <div class="form-grid">
                    <input type="text" id="producto" placeholder="Nombre del producto" />
                    <input type="text" id="codigoBarras" placeholder="C칩digo de barras (opcional)" />
                    <select id="descripcion" required>
                        <option value="">Selecciona una categor칤a</option>
                        <option value="viveres">V칤veres</option>
                        <option value="bebidas">Bebidas</option>
                        <option value="licores">Licores</option>
                        <option value="enlatados">Enlatados</option>
                        <option value="lacteos">L치cteos</option>
                        <option value="carnes">Carnes</option>
                        <option value="frutas">Frutas</option>
                        <option value="verduras">Verduras</option>
                        <option value="aseo_personal">Aseo Personal</option>
                        <option value="limpieza">Limpieza</option>
                        <option value="otros">Otros</option>
                    </select>
                    <input type="number" id="costo" placeholder="Costo del producto (en $)" step="0.01" />
                    <input type="number" id="ganancia" placeholder="Porcentaje de ganancia %" step="0.1" />
                    <input type="number" id="unidadesPorCaja" placeholder="Unidades por caja / kg" step="0.01" />
                    <input type="number" id="unidadesExistentes" placeholder="Unidades existentes" step="0.01" />
                </div>
                <div class="form-actions">
                    <button onclick="calcularPrecioVenta()" class="btn-secondary"><i class="fas fa-calculator"></i> Calcular Precio</button>
                    <button onclick="guardarProducto()" class="btn-primary"><i class="fas fa-save"></i> Guardar Producto</button>
                </div>
                <p id="precioUnitario" class="info-message"></p>
            </div>
        </section>

        <!-- SECCI칍N INVENTARIO (Lista de Productos) -->
        <section id="inventario-section" class="content-section">
            <h1><i class="fas fa-clipboard-list"></i> Inventario</h1>

            <div class="card">
                <div class="inventory-toolbar">
                    <input type="text" id="buscar" placeholder="Buscar producto..." />
                    <button onclick="buscarProducto()"><i class="fas fa-search"></i></button>
                </div>
                <div class="table-responsive">
                    <table id="productosTable">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Cat.</th>
                                <th>Existencias</th>
                                <th>P/U ($)</th>
                                <th>P/U (Bs)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- SECCI칍N REPORTES -->
        <section id="reportes-section" class="content-section">
            <h1><i class="fas fa-file-pdf"></i> Reportes y Etiquetas</h1>

            <div class="card">
                <h2>Generar Documentos</h2>
                <div class="action-buttons">
                    <button onclick="generarReporteDiario()" class="report-btn"><i class="fas fa-file-pdf"></i> Reporte Diario</button>
                    <button onclick="mostrarListaCostos()" class="report-btn"><i class="fas fa-list"></i> Lista de Costos</button>
                    <button onclick="mostrarOpcionesPDF()" class="report-btn"><i class="fas fa-tags"></i> PDF por Categor칤a</button>
                    <button onclick="generarEtiquetasAnaqueles()" class="report-btn"><i class="fas fa-tag"></i> Etiquetas Anaqueles</button>
                </div>
                <div id="listaCostosContainer" style="display: none;">
                    <h3>Lista de Costos</h3>
                    <div class="total-invertido">
                        <strong>Total invertido:</strong>
                        <span id="totalInvertidoUSD">X USD</span>
                        <span id="totalInvertidoBS">/ X Bs</span>
                    </div>
                    <ul id="listaCostos"></ul>
                </div>
            </div>
        </section>

        <!-- SECCI칍N CONFIGURACI칍N -->
        <section id="configuracion-section" class="content-section">
            <h1><i class="fas fa-cog"></i> Configuraci칩n</h1>

            <div class="card">
                <h2>Nombre del Establecimiento</h2>
                <input type="text" id="nombreEstablecimiento" placeholder="Ej: Tienda La Bendici칩n" />
                <button onclick="guardarNombreEstablecimiento()">Guardar</button>
            </div>

            <div class="card">
                <h2>Tasa BCV</h2>
                <input type="number" id="tasaBCV" placeholder="Tasa BCV" step="0.01" />
                <button onclick="actualizarTasaBCV()">Actualizar Tasa</button>
            </div>

            <div class="card">
                <h2>Seguridad</h2>
                <button onclick="mostrarModalCambiarClave()" class="btn-secondary"><i class="fas fa-key"></i> Cambiar Clave de Seguridad</button>
            </div>
        </section>

        <!-- SECCI칍N RESPALDO -->
        <section id="respaldo-section" class="content-section">
            <h1><i class="fas fa-database"></i> Respaldo y Restauraci칩n</h1>

            <div class="card">
                <p>Descarga un archivo de respaldo con todos tus datos o restaura desde uno existente.</p>
                <button onclick="descargarBackup()" class="backup-button"><i class="fas fa-download"></i> Descargar Respaldo</button>
                <button onclick="document.getElementById('fileInput').click()" class="restore-button"><i class="fas fa-upload"></i> Cargar Respaldo</button>
                <input type="file" id="fileInput" accept=".json" style="display: none" onchange="cargarBackup(this.files)" />
            </div>
        </section>
    </main>

    <!-- ===== MODALES (sin cambios, pero reubicados para claridad) ===== -->
    <div id="modalPago" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="cerrarModalPago()">&times;</span>
            <h3>Seleccionar M칠todo de Pago</h3>
            <div class="resumen-venta">
                <p id="resumenTotalBs">Total: Bs 0,00</p>
                <p id="resumenTotalDolares">Total: $ 0,00</p>
            </div>
            <div class="metodos-pago">
                <button onclick="seleccionarMetodoPago('efectivo_bs')">Efectivo Bs</button>
                <button onclick="seleccionarMetodoPago('efectivo_dolares')">Efectivo $</button>
                <button onclick="seleccionarMetodoPago('punto')">Punto</button>
                <button onclick="seleccionarMetodoPago('pago_movil')">Pago M칩vil</button>
                <button onclick="seleccionarMetodoPago('biopago')">Biopago</button>
            </div>
            <div id="detallesPago" style="display: none;">
                <h4>Detalles del Pago</h4>
                <div id="camposPago"></div>
                <div id="mensajePago" class="mensaje-pago" style="display: none;"></div>
                <div class="modal-buttons">
                    <button onclick="confirmarMetodoPago()">Confirmar Pago</button>
                    <button onclick="cancelarPago()" class="btn-cancelar">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modales para Categor칤as PDF y Etiquetas (mantener igual) -->
    <div id="modalCategorias" class="modal" style="display: none;">...</div>
    <div id="modalEtiquetas" class="modal" style="display: none;">...</div>
    <div id="modalClave" class="modal" style="display: none;">...</div>
    <div id="modalCambiarClave" class="modal" style="display: none;">...</div>

    <!-- Toast container -->
    <div id="toastContainer" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="script.js"></script>
</body>
</html>
